
name: Cypress Tests

on:
	push:
		branches: [ main ]
	pull_request:
		branches: [ main ]

permissions:
	contents: read

jobs:
	cypress-run:
		name: Run Cypress tests
		runs-on: ubuntu-latest
		strategy:
			matrix:
				node-version: [18.x]
		steps:
			- name: Checkout repository
				uses: actions/checkout@v4

			- name: Setup Node.js
				uses: actions/setup-node@v4
				with:
					node-version: ${{ matrix.node-version }}

			- name: Cache node modules
				uses: actions/cache@v4
				with:
					path: ~/.npm
					key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
					restore-keys: |
						${{ runner.os }}-node-

			- name: Install dependencies
				run: |
					if (Test-Path package-lock.json) { npm ci } else { npm install }

			- name: Run Cypress (headless)
				run: npx cypress run --browser chrome

			- name: Upload Cypress videos
				if: always()
				uses: actions/upload-artifact@v4
				with:
					name: cypress-videos
					path: cypress/videos

			- name: Upload Cypress screenshots
				if: always()
				uses: actions/upload-artifact@v4
				with:
					name: cypress-screenshots
					path: cypress/screenshots

			- name: Upload Allure results
				if: always()
				uses: actions/upload-artifact@v4
				with:
					name: allure-results
					path: allure-results
